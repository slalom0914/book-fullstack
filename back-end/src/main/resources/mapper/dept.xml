<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.demo.DeptMapper">
	<delete id="deptDelete" parameterType="com.example.demo.vo.DeptVO">
		DELETE FROM dept WHERE deptno = #{deptno}
	</delete>
	<update id="deptUpdate" parameterType="map">
		UPDATE dept
		   SET dname = #{dname} 
		      ,loc = #{loc} 
		 WHERE deptno= #{deptno}	
	</update>

	<insert id="deptInsert" parameterType="map" >  
	insert into dept (deptno, dname, loc) 
	values (#{deptno}, #{dname}, #{loc}) 
	</insert>

	<select id="currentDate" parameterType="string" resultType="string">
		SELECT to_char(sysdate, 'YYYY-MM-DD') FROM dual
	</select>
<!-- 
myBatis에서는 조회결과에 대해서 resultType에 자동으로 담아 준다.
이 때 타입이 Map이어서 키값이 필요한데 키값이 대문자로 저장됨.
리액트에서는 컴포넌트 일때 대문자로 해야 한다. 
이 부분이 있어 변수는 소문자로 사용함. -> 변수명을 통일하고 일관되게 사용하려고
dept.xml문서의 컬럼명 자리에 별칭을 소문자로 붙여 주면 키값이 소문자로 처리됨.
-->

	<select id="deptList"
			parameterType="com.example.demo.vo.DeptVO"
			resultType="Map">
		SELECT deptno as "deptno",
		dname  as "dname",
		loc    as "loc"
		FROM dept

		<where>
			<if test="keyword != null and keyword != '' and searchType != null and searchType != ''">
				<choose>

					<!-- 1) 부서번호로 검색 (숫자 컬럼) -->
					<when test="searchType == 'deptno'">
						deptno = #{keyword}
					</when>

					<!-- 2) 부서명으로 검색 -->
					<when test="searchType == 'dname'">
						dname LIKE '%' || #{keyword} || '%'
					</when>

					<!-- 3) 지역으로 검색 -->
					<when test="searchType == 'loc'">
						loc LIKE '%' || #{keyword} || '%'
					</when>

					<!-- 혹시 searchType이 이상하게 오면 전체 조회 -->
					<otherwise>
						1=1
					</otherwise>

				</choose>
			</if>
		</where>
	</select>


</mapper>